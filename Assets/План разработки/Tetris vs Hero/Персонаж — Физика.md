# Персонаж — Физика (Celeste-стиль)

`CharacterController2D.cs` — кастомная физика без `Rigidbody2D`.
Коллизии: **AABB vs Grid2D\<CellData\>**.

## Механики

| Механика | Описание |
|----------|----------|
| **Горизонталь** | Ускорение + замедление (не мгновенная скорость) |
| **Coyote Time** | ~0.12с — прыжок сразу после края платформы |
| **Jump Buffer** | ~0.12с — прыжок чуть до приземления |
| **Variable Jump Height** | Отпустил кнопку раньше → ниже прыгнул |
| **Wall-Slide** | У стены гравитация × 0.3 |
| **Wall-Jump** | Отталкивание от стены |

## Параметры (Inspector)

```
_maxSpeed      = 6f
_acceleration  = 40f
_deceleration  = 50f
_jumpForce     = 12f
_gravity       = -30f
_coyoteTime    = 0.12f
_jumpBufferTime = 0.12f
_variableJumpMult = 0.45f
_wallSlideGravMult = 0.3f
_wallJumpForce = (8, 12)
_wallJumpLockTime = 0.15f
_colliderWidthCells  = 0.8
_colliderHeightCells = 1.8
```

## Порядок Update

```
HandleAttack()
HandleHorizontal(dt)
HandleJumpInput()
ApplyGravity(dt)
MoveAndCollide(dt)
view.UpdateAnimations()
```

## Collision sampling

- `SampleWall` — 2 точки по высоте (25%, 75%)
- `SampleFloor` — 3 точки по ширине (−90%, 0%, +90%)
- `SampleCeiling` — 3 точки по ширине

> **Проблема:** `IsCellOccupied` проверяет только зафиксированные ячейки.
> Активная падающая фигура не блокирует персонажа.
> → [[Взаимодействия блоков и персонажа#Активная фигура не блокирует персонажа]]

---

← [[Tetris vs Hero]] · [[Управление]] · → [[Взаимодействия блоков и персонажа]] · [[Архитектура MVC]]
